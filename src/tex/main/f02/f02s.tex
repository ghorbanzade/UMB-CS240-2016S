%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CS240: Programming in C
% Copyright 2015 Pejman Ghorbanzade <mail@ghorbanzade.com>
% Creative Commons Attribution-ShareAlike 4.0 International License
% https://github.com/ghorbanzade/UMB-CS240-2016S/blob/master/LICENSE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def \topDirectory {.}
\def \texDirectory {\topDirectory/src/main/tex}
\def \resDirectory {\topDirectory/src/main/c/f02}

\documentclass[12pt,letterpaper,twoside]{article}
\usepackage{\texDirectory/template/style/directives}
\usepackage{\texDirectory/template/style/assignment}
\input{\texDirectory/template/config}

\usepackage{amsmath}

\begin{document}

\doc{title}{Solution to Final Exam}
\doc{date-pub}{May 16, 2016 at 6:30 PM}
\doc{date-due}{May 16, 2016 at 9:30 PM}
\doc{points}{20}

\prepare{header}

\section*{Question 1}

The following programs compile and run as expected.
Determine what each program prints on standard output.

\lstset{language=c,tabsize=4}
\begin{enumerate}[label=(\alph*)]
\item \lstinline{}
\lstinputlisting[firstline=10]{\resDirectory/hello-world.c}
\item \lstinline{}
\lstinputlisting[firstline=10]{\resDirectory/count-down.c}
\item \lstinline{}
\lstinputlisting[firstline=10]{\resDirectory/recursion.c}
\item \lstinline{}
\lstinputlisting[firstline=10]{\resDirectory/pointer.c}
\end{enumerate}

\subsection*{Solution}

\begin{enumerate}[label=(\alph*)]
\item
Line 7 replaces address of \texttt{Hello} memory block with address of \texttt{World!} memory block.
Standard output will be \texttt{World! World!}.

\item
Every iteration of \texttt{while} loop in line 8, shifts value of \texttt{num} variable one bit to the right.
Standard output will be \texttt{16 8 4 2 1}.

\item
Recursive calls to function \texttt{func} produces 5 entries in the function call stack.
Output will be printed from last function call to the first.
Standard output will be \texttt{5 4 3 2 1}.

\item
Both functions \texttt{func1} and \texttt{func2} modify the value they are passed to and do not affect variables declared in \texttt{main} function.
Standard output will be \texttt{World! World!}.
\end{enumerate}

\newpage

\section*{Question 2}

The following functions compile and run as expected.
Briefly explain what each function is used for.
For each function, write a simple \texttt{main()} function that calls the function.

\lstset{language=c,tabsize=4}
\begin{enumerate}[label=(\alph*)]
\item \lstinline{}
\lstinputlisting[firstline=16,lastline=33]{\resDirectory/str2int.c}
\item \lstinline{}
\lstinputlisting[firstline=17,lastline=29]{\resDirectory/matrix.c}
\newpage
\item \lstinline{}
\lstinputlisting[firstline=16,lastline=27]{\resDirectory/adjacent.c}
\item \lstinline{}
\lstinputlisting[firstline=12,lastline=15]{\resDirectory/strcpy.c}
\end{enumerate}

\subsection*{Solution}

\lstset{language=c,tabsize=4}
\begin{enumerate}[label=(\alph*)]
\item
Converts a given string literal to its numeric value.
Returns $-1$ if conversion is not possible.
\lstinputlisting[firstline=38,lastline=50]{\resDirectory/str2int.c}

\item
Generates an $n \times n$ matrix with random one-digit elements.
\lstinputlisting[firstline=48,lastline=62]{\resDirectory/matrix.c}

\item
Checks whether a given string has similar adjacent characters.
\lstinputlisting[firstline=32,lastline=48]{\resDirectory/adjacent.c}

\item
Copies characters of a string to another string.
Assumes destination buffer is large enough to store characters of source string.
\lstinputlisting[firstline=17,lastline=23]{\resDirectory/strcpy.c}
\end{enumerate}

\section*{Question 3}

The C programming language, as of C99, supports complex number math with the three built-in types \texttt{double \_Complex}, \texttt{float \_Complex}, and \texttt{long double \_Complex}.
When the header \texttt{<complex.h>} is included, the three complex number types are also accessible as \texttt{double complex}, \texttt{float complex}, \texttt{long double complex}.
Standard arithmetic operators \texttt{+}, \texttt{-}, \texttt{*}, \texttt{/} can be used with real, complex, and imaginary types in any combination.

The following program shows how complex numbers can be used in C. It loads components of complex numbers from a file and prints their sum on standard output.

\lstset{language=c,tabsize=4}
\lstinputlisting[firstline=10]{\resDirectory/complex-numbers.h}
\lstinputlisting[firstline=10]{\resDirectory/complex-numbers.c}

The program compiles and executes as expected.
Based on the given source code, provide \textbf{brief} answers for the following questions.

\begin{enumerate}
\item
In \texttt{complex-numbers.h:10}, function \texttt{cprint} is declared but not defined.
What is the advantage of declaring a function in a header file?
Explain why removing this line causes a compilation error and how the error can be resolved without including this line.

\item
In \texttt{complex-numbers.c:13}, \texttt{fp} is checked to make sure it is not \texttt{null}.
A CS240 student argues this checking is unnecessary if we make sure the file \texttt{complex-numbers.txt} exists.
Describe whether you support this argument or not and provide brief explanations for your reasoning.

\item
In \texttt{complex-numbers.c:17}, variables \texttt{a} and \texttt{b} are passed by reference to function \texttt{scanf}.
Explain what happens if they are passed by value.

\item
In \texttt{complex-numbers.c:18}, \texttt{I} is used but it is not explicitly declared either in \texttt{complex-numbers.c} or \texttt{complex-numbers.h}.
This also applies to functions \texttt{creal} and \texttt{cimag} in \texttt{complex-numbers.c:31}.
Briefly explain why such practice has not caused compilation error.

\item
In \texttt{complex-numbers.c:21}, variable \texttt{sum} is passed to \texttt{cprint} by value. Modify this line and the function \texttt{cprint} such that \texttt{num} is passed by reference.

\end{enumerate}

\newpage

\subsection*{Solution}

\begin{enumerate}
\item
Declaring a function in the header file introduces the function to the compiler, allowing the function to be called in other functions before it is declared.
More importantly, declaring the function in the header file allows function implementation to be reused by other programs importing the header file.

\item
Checking value of file pointer is necessary, since the file with the given filename may exist but may be open by another program or the running process may not have permissions to open the file.

\item
If variables \texttt{a} and \texttt{b} are passed by value, the \texttt{scanf} function receives a copy of their values and has no way of modifying variables declared in the \texttt{main} function.

\item
Functions \texttt{creal} and \texttt{cimag} are declared in \texttt{<complex.h>} header file.

\item
\texttt{complex-numbers.c:21} should be changed to the following.
\begin{lstlisting}[numbers=none]
cprint(&sum);
\end{lstlisting}

Function \texttt{cprint()} should be rewritten as follows.
\begin{lstlisting}[numbers=none]
void cprint(double complex *num)
{
	printf("(%.2f, %.2f)\n", creal(*num), cimag(*num));
}
\end{lstlisting}

\end{enumerate}

\newpage

\section*{Question 4}

Since fall of You-Know-Who, Parvati Patil has been working as payroll clerk at Ministry of Magic.
She is responsible for preparing and reporting of payroll checks.
To prevent fraud and curruption, the Ministry has prohibited any use of magic in department of Human Resources.
Parvati is therefore required to calculate all payrolls as Muggles do.
Given the number of employees working at the Ministry, she has been thinking to write a software that automates payroll calculations for all employees.

Depending on their status, employees have different pay rates in the Ministry as given in Table \ref{tablequestion5}.
As is shown, part time and interns are paid by hour whereas full time employees are paid regardless of the number of hours they have worked.

You are asked to help in design of the payroll system for the Ministry.
Each employee has a name, an ID, the number of hours he has worked in a month and a status which is either full time, part time or intern.

\begin{enumerate}
\item Define a structure \texttt{employee} to enclose required information for a given employee.
\item Write a function that takes data of an employee and returns an initialized employee structure.
\item Write a function that takes an employee structure and calculates the monthly pay for that employee.
\item Write a function that takes an array of employee structures and returns the total amount to be paid to those employees.
\end{enumerate}

\begin{table}[H] \centering
\begin{tabular}{r c}
\textbf{Status} & \textbf{Rate}\\
\hline
Full Time & 800 Galleons / Month\\
Part Time & 4 Galleons / Hour\\
Intern & 2 Galleons / Hour
\end{tabular}
\caption{Pay rates for employees of Ministry of Magic}
\label{tablequestion5}
\end{table}

\subsection*{Solution}

\begin{enumerate}
\item \lstinline{}
\lstinputlisting[firstline=13,lastline=23]{\resDirectory/employee.c}
\item \lstinline{}
\lstinputlisting[firstline=25,lastline=33]{\resDirectory/employee.c}
\item \lstinline{}
\lstinputlisting[firstline=35,lastline=44]{\resDirectory/employee.c}
\item \lstinline{}
\lstinputlisting[firstline=46,lastline=53]{\resDirectory/employee.c}
\end{enumerate}

\section*{Question 5}

The following structure is defined to implement a resizable array of integers.

\lstset{language=c,tabsize=4}
\lstinputlisting[firstline=20,lastline=24]{\resDirectory/array-list.h}

\begin{enumerate}
\item Write a function with the following signature that returns value of element $e_{i}$ of the array $A$ where $i$ is the element index.

\lstinputlisting[firstline=28,lastline=28,numbers=none]{\resDirectory/array-list.h}

\item Write a function with the following signature that updates value of element $e_{i}$ of the array $A$ with a given value $v$, where $i$ is the index..
The function is expected to return previous value of $e_{i}$.

\lstinputlisting[firstline=29,lastline=29,numbers=none]{\resDirectory/array-list.h}
\end{enumerate}

\subsection*{Solution}

\lstinputlisting[firstline=56,lastline=60]{\resDirectory/array-list.c}
\lstinputlisting[firstline=66,lastline=73]{\resDirectory/array-list.c}

\end{document}
